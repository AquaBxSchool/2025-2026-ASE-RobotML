<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="README_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="README_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="labs-on-domain-specific-languages-dsl" class="level1">
<h1>Labs on Domain-Specific Languages (DSL)</h1>
<p>These lab sessions are to be realized in groups of two.</p>
<section id="overall-objectives-of-the-lab" class="level2">
<h2 class="anchored" data-anchor-id="overall-objectives-of-the-lab">Overall objectives of the lab</h2>
<p>During these lab sessions, you will create your own version of RoboML, a language to define the behavior of a small robot. Building the DSL will include modeling the domain (<em>i.e.</em>, the concepts and their relationships), and implements the associated tooling: <em>e.g.</em>, the text editor and its services, an interpreter (through a web-based simulator) and a compiler (to Arduino code that will run on the robot itself).</p>
<p>Below, you can find an example of a program that we expect to write in your language.</p>
<pre><code>let void entry () {
    setSpeed(150 in mm) // distance per second (here 150mm/s)
    var number count = 0
    loop count &lt; 5
    {
        count = count + 1
        square()
    }
}

let void square(){
    Forward 30 in cm
    Clock 90
    Forward 300 in mm
    Clock 90
    Forward 30 in cm
    Clock 90
    Forward 300 in mm
    Clock 90
}</code></pre>
<p>setClock(tick) getClock(tick)</p>
<p>setSpeed(speed) getSpeed(speed)</p>
<p>Forward(distance) Backward(distance) Leftward(distance) Rightward(distance)</p>
<p>Rotate(+-angle)</p>
<p>getSensorValue(DISTANCE)</p>
<p>The above program, when executed, should set the speed of the robot and then perform 5 times (loop) a square pattern movement (square function).</p>
<p>The robot used for this lab has four wheels with individual motors, and an ultrasound sensor which can be used to measure distance to an object in front. We expect your language to mostly follow the imperative programming paradigm, with basic arithmetic and commands for the robot.</p>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<p>These labs are split into three parts corresponding to the three main aspects of DSLs implementation: abstract syntax, concrete syntax, and semantics.</p>
<p>The lab sessions for this course will consist in the realization of these aspects.</p>
<p>To encourage you to finish completely at least one of the two possible semantics, yet exploring both compilation and interpretation, you will have to choose a major and a minor semantics. The major semantics will be used to evaluate your project. The minor one is not mandatory but can give you bonus points. The evaluation grid is the following:</p>
<ul>
<li>Abstract syntax: 5</li>
<li>Concrete Syntax: 5</li>
<li>Semantics: 10</li>
</ul>
<p>By the end of the module, you must submit a Git repository containing all your source files, along with a comprehensive README that clearly describes the project’s structure, its functionality, and the engineering decisions you made, including the reasoning behind each choice.</p>
</section>
<section id="part-1---domain-modeling-definition-of-the-languages-metamodel-with-ecore" class="level2">
<h2 class="anchored" data-anchor-id="part-1---domain-modeling-definition-of-the-languages-metamodel-with-ecore">Part 1 - Domain modeling: definition of the language’s metamodel with Ecore</h2>
<p>The first step in defining a language is to model the concepts and their relationships in the domain targeted by your language. This results in the creation of the language’s metamodel, defining its abstract syntax. For this part, you can pick any tool you want: the Ecore framework, an online UML editor, or even simply a pen and a piece of paper!</p>
<p>If you chose Ecore, there are some instructions below to help with the technical aspect.</p>
<p>There is a short list of mandatory concepts that we want:</p>
<ul>
<li>Basic arithmetic and boolean expressions</li>
<li>Control structure (loop, conditions)</li>
<li>Functions and variables</li>
<li>Movement (front, back, sides)</li>
<li>Rotation</li>
<li>Speed</li>
<li>Sensors (time, distance to obstacle in front of the robot)</li>
<li>Units (<em>e.g.</em>, cm, mm)</li>
</ul>
<p><strong>N.B.:</strong> For units, you can either implement it as “cast function” or as a concrete type in the language.</p>
<blockquote class="blockquote">
<p>For units, you can either implement it as “cast function” or as a concrete type in the language.<br>
As a cast -&gt; <code>var number length = 10 in cm</code>.<br>
As a type -&gt; <code>var cm length = 10</code>.</p>
</blockquote>
<p>Your metamodel needs to support generic programming constructs, so that the robot can be programmed with real logic.</p>
<section id="arithmetic-and-boolean-expressions" class="level3">
<h3 class="anchored" data-anchor-id="arithmetic-and-boolean-expressions">1. Arithmetic and Boolean Expressions</h3>
<p>Think of expressions as a hierarchy. An expression can be a constant, a variable reference, a function call, or an operation combining other expressions.</p>
<p>Each operator (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>&amp;&amp;</code>, <code>||</code>, <code>!</code>) can be modeled as a concept that has references to its left and right operands.</p>
<p>Hint: You don’t need one class per operator if you don’t want — there are common modeling patterns for expression trees.</p>
<p>Important: expressions should be composable, i.e.&nbsp;you can put them inside each other, and they should be usable anywhere a value is expected (conditions, loop guards, assignments, etc.).</p>
</section>
<section id="control-structures" class="level3">
<h3 class="anchored" data-anchor-id="control-structures">2. Control Structures</h3>
<p>You need a way to express loops and conditional branching. Both of these depend on an expression (the condition). They also both contain a block of statements (the body).</p>
<p>Hint: think about reusing the same concept of Block (a sequence of statements) for function bodies, loop bodies, and the “if” and “else” parts.</p>
</section>
<section id="functions-and-variables" class="level3">
<h3 class="anchored" data-anchor-id="functions-and-variables">3. Functions and Variables</h3>
<p>Functions have: a name, parameters, a return type, and a body (a block of statements). Variables can be declared and assigned. They need a name, a type, and a value (an expression).</p>
<p>Hint: functions and variables are both named symbols that can be referred to later in the program. Try to avoid duplicating concepts unnecessarily.</p>
</section>
<section id="domain-specific-integration" class="level3">
<h3 class="anchored" data-anchor-id="domain-specific-integration">4. Domain Specific Integration</h3>
<p>Remember that all these constructs should work together with the robotics domain concepts.</p>
<p>Example: a loop condition might use a sensor (getDistance() &lt; 10), and the loop body might call movement commands.</p>
<p>Example: a variable can store the result of a sensor and later be used as a distance argument in a Forward command.</p>
</section>
<section id="ecore-modeling" class="level3">
<h3 class="anchored" data-anchor-id="ecore-modeling">Ecore modeling</h3>
<p>Within your Eclipse RCP that includes EMF, Xtext, and Xtend (e.g., <a href="https://www.eclipse.org/downloads/packages/release/2025-09/r/eclipse-ide-java-and-dsl-developers">Eclipse DSL 2025-09</a> with the added <a href="https://projects.eclipse.org/projects/modeling.emft.ecoretools">Ecore tools 4.0</a> which you can install with <em>Help</em> -&gt; <em>Eclipse Marketplace…</em> -&gt; search for <code>ecoretools</code>), create an <em>Ecore Modeling Project</em>. Then you can start modeling your domain as an object-oriented metamodel, which should represent the different concepts of your language and how they are related.</p>
<p>You may validate your metamodel by right-clicking on your ecore model and then clicking on <em>Validate</em>.</p>
<p>When this is done, you can generate the Java-based implementation of your domain model by opening the associated <code>genmodel</code> file, right-clicking on the root element, and <em>Generate all</em>. This is not mandatory to continue the lab.</p>
<p>You may assess the expressivity of your metamodel (<em>i.e.</em>, check if it captures your domain well, in your case meaning it supports the modeling of the proposed example) by opening the Ecore metamodel, right-click on the concept of the root element of your expected model, and choose <em>Create dynamic instance</em>. Then you can create a model in a tree-based editor, and ensure your metamodel supports the expected model structure.</p>
</section>
</section>
<section id="part-2---textual-modeling-definition-of-the-langium-grammar-and-editor-for-your-language" class="level2">
<h2 class="anchored" data-anchor-id="part-2---textual-modeling-definition-of-the-langium-grammar-and-editor-for-your-language">Part 2 - Textual modeling: definition of the Langium grammar and editor for your language</h2>
<p>After determining the domain, it is time to move on to the actual text editor for your language. In this lab, we will build this editor using the TypeScript-based <a href="https://langium.org/">Langium</a> workbench to build a Visual Studio Code extension supporting the edition of your language.</p>
<p>If not done already, you will need to install a <a href="https://nodejs.org/en/download">node environment</a> as well as <a href="https://code.visualstudio.com/docs/setup/setup-overview">Visual Studio Code</a>, and then run the command <code>npm i -g yo@5.1.0 generator-langium@3.3.0</code> to install the Langium project generator. Then, run <code>yo langium</code> to create the project. This will offer to create a few different things; you <strong>have to</strong> say yes to all of them, pick a language name, extension name, and a file extension (<em>e.g.</em> .rob). You can also install the Langium extension from the VSCode marketplace, to have syntax highlighting and validation in your grammar.</p>
<blockquote class="blockquote">
<p>[!IMPORTANT] We use a particular version of yo and generator-langium in these labs due to the rapid change in the version of Langium. <strong>Make sure that you use these versions</strong>.</p>
</blockquote>
<p>Depending on what modeling tool you picked in Part 1, the next step can change a little bit. If you picked another method than Ecore, skip the following section.</p>
<blockquote class="blockquote">
<p>[!NOTE] There is flexibility in the concrete syntax of the language, but make it concise and usable for non-experts in programming. Ask your teacher during labs if you plan to change the syntax.</p>
</blockquote>
<section id="ecore-modeling-1" class="level3">
<h3 class="anchored" data-anchor-id="ecore-modeling-1">Ecore modeling</h3>
<p>If you decided to model your domain using Ecore and Eclipse in the previous part, you may be aware that it is possible to generate an Xtext project from an Ecore project (by creating a new <em>Xtext Project From Existing Ecore Models</em>). Fortunately, it is possible to convert an Xtext grammar into a Langium grammar thanks to <a href="https://github.com/TypeFox/xtext2langium">this project</a>. You can thus write your grammar using Xtext rather than Langium if you so wish.</p>
<p>To convert a grammar, go to the Eclipse menu <em>Help</em> -&gt; <em>Install new software</em> -&gt; in the site field, paste the URL <code>https://typefox.github.io/xtext2langium/download/updates/v0.4.0/</code> and install the package. Afterward, go into your Xtext project’s <code>META-INF/MANIFEST.MF</code>, switch to the <em>Dependencies</em> tab, and add Xtext2langium as a dependency. Don’t forget to save your manifest file. Then you can go to the MWE2 file (named something like <code>GenerateMyDsl.mwe2</code>) in your project, and replace the <code>fragment</code> field with:</p>
<pre><code>fragment = io.typefox.xtext2langium.Xtext2LangiumFragment {
        outputPath = './langium'
    }</code></pre>
<p>Right-click the MWE2 file and run it. You should see a <code>langium</code> folder appear in your project, with corresponding <code>.langium</code> grammar files which you can put into your <code>src/language/</code> folder of the Langium project. Make sure the grammars names match up between your projects, otherwise you will have to manually refactor the conflicts.</p>
</section>
<section id="other-types-of-modeling" class="level3">
<h3 class="anchored" data-anchor-id="other-types-of-modeling">Other types of modeling</h3>
<p>Since you have previously modeled your domain, we need to translate that modeling effort into a metamodel that can be understood by Langium. This can be done by inserting TypeScript-like interfaces in the grammar, the full specification of which can be seen <a href="https://langium.org/docs/reference/semantic-model/#declared-types">here</a>. As an example, this could be the model used for a Finished State Machine language:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode ts code-with-copy"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> StateMachine {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    states<span class="op">:</span> State[]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    transitions<span class="op">:</span> Transition[]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    initialState<span class="op">:</span> State</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> State {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    output<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Transition {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    start<span class="op">:</span> @State</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    target<span class="op">:</span> @State</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can then write the textual grammar rules that will return your specified types.</p>
</section>
<section id="vscode-extension-with-langium" class="level3">
<h3 class="anchored" data-anchor-id="vscode-extension-with-langium">VSCode extension with Langium</h3>
<p>Once you have a valid <a href="https://langium.org/docs/grammar-language/">Langium grammar</a>, you can launch the commands <code>npm run langium:generate</code> and <code>npm run build</code> to build the project.</p>
<p>You can test your editor as you make changes either by launching the command <code>code --extensionDevelopmentPath=$PWD</code>, or by starting a debug session in VSCode, both of which will open a VSCode instance with your extension loaded in. You can create examples and test files for your language in this instance. A goal for this part can be to have your language parse the examples given in this document, such as the following:</p>
<pre><code>let void entry () {
    setSpeed(200 mm) // distance per second (here 200mm/s)
    var number time = getTimestamp()
    loop time &lt; 60000
    {
        var number dist = getDistance() in cm
        Forward dist - 25 in cm
        Clock 90
        time = getTimestamp()
    }
}</code></pre>
<blockquote class="blockquote">
<p>[!NOTE] If you have made changes to the syntax, the equivalent AST with your syntax is your test.</p>
</blockquote>
</section>
<section id="how-to-verify-my-grammar" class="level3">
<h3 class="anchored" data-anchor-id="how-to-verify-my-grammar">How to verify my grammar?</h3>
<p>When the grammar grows, it may be difficult to verify if your grammar is valid. Even by testing your language, you cannot ensure your AST is built as you want. To help language designers with this task, Langium provides two different tools.</p>
<p>The first one is directly accessible from the Langium VSCode extension, by typing <code>&gt;railroad</code> in the quick access (CTRL + SHIFT + P) and clicking on “Langium: Show Railroad Syntax Diagram”. This will open a new panel and display you your grammar in a graphical way. It allows you to verify your grammar at a higher level.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/railroad.png" class="img-fluid figure-img"></p>
<figcaption>railroad</figcaption>
</figure>
</div>
<p>The second one is accessible from the Langium website, on the <a href="https://langium.org/playground/"><code>Playground</code> page</a>. Here you can paste your grammar (without forgetting to also past your types and terminals, and removing your imports) and a program conforms to the grammar. By clicking on the “Tree” icon, you can open a new panel displaying the abstract syntax tree of your program, in JSON. However be aware, the playground has sometimes some refresh issues so the program text editor may be not synchronized anymore with the grammar one.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/playground.png" class="img-fluid figure-img"></p>
<figcaption>playground</figcaption>
</figure>
</div>
</section>
</section>
<section id="part-3---executable-modeling" class="level2">
<h2 class="anchored" data-anchor-id="part-3---executable-modeling">Part 3 - Executable modeling</h2>
<p>In the previous steps, you have first identified the core concepts of your language and implemented a textual syntax to define instances of those concepts. By now, your programs should be parsable, which means Langium will be able to give you an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree</a> (AST) representing your programs. The next step is to try and execute those model instances: this can be done either through interpretation or compilation. You will need to implement these in a <code>compiler.ts</code> and <code>interpreter.ts</code> file (take a look at the <code>generator.ts</code> in the cli folder), which you should put in a new <code>src/semantics/</code> folder.</p>
<p>To execute the program, you will use the <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor design pattern</a> to implement a compiler targeting the Arduino language (allowing the execution on a real robot) and an interpreter directly executing the program. The visitor pattern allows you to split the language definition into two parts: the syntax (abstract syntax defined through the metamodel and concrete syntax defined by the grammar), and the semantics (interpreter and compiler), easing the extension/evolution of the language semantics. Each method implemented in a visitor represents the semantics of a concept, often relying on the semantics of its child in the AST.</p>
<p>Langium does not provide a visitor pattern by default. To avoid creating the pattern manually, you can use an external library: <a href="https://www.npmjs.com/package/langium-visitor">langium-visitor</a>. To use it, you will need to install it in your project with <code>npm i -D langium-visitor</code>. You can then add a new script command in your <code>package.json</code> file to generate the visitor: <code>"langium:visitor": "langium-visitor"</code>. The library will use the JSON grammar compiled by Langium from your <code>.langium</code> files to automatically generate the visitor interfaces. More information about how to plug the visitor into your Langium project can be found on the <a href="https://github.com/theogiraudet/langium-visitor">Github repository</a>.</p>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation:</h3>
<p>In this lab, your interpreter will run on a web-based simulator for the robot written in JavaScript. You will find in the interpreter folder of this repository, the code of the simulator provided for this part of the lab. The Typescript files in the <code>src/web/simulator</code> folder represent the elements of the simulation used in your interpreter. Especially, you will find the <em>Robot</em> class that will be manipulated by your interpreter. In addition, you will find the scene classes representing the environment in which the robot evolves.<br>
The scene <strong>REQUIRES</strong> you to add timestamp objects recording the steps of the simulation to replay it on the web page.<br>
The TypeScript files in the <code>src/web/lib</code> folder are used to display the simulation on the web page and should only be used on the client side. This TypeScript code expects to receive the final state of the scene simulated. The <code>static</code> folder needs to be merged with the <code>static</code> folder of Langium and the <code>index.html</code> files must replace the existing one. Finally, we use P5 to render the simulation in the browser, so you have to install it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> i p5@1.11.3</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> i <span class="at">-D</span> @types/p5@1.7.6</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To understand how to create the communication between the LSP server and the client, we propose you to first create a ‘parseAndValidate’ LSP action. The general idea of the ‘parseAndValidate’ action can be found <a href="https://web.archive.org/web/20230323045804/https://langium.org/tutorials/customizing_cli/">here</a>, while the code required to define new LSP action usable in the web is detailed <a href="https://web.archive.org/web/20230323041439/https://langium.org/tutorials/generation_in_the_web/">here</a>. However, the documentation for the web part is currently outdated for the latest version of Langium. Instead of it, you can add this code in the <code>src/setupClassic.ts</code> file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode ts code-with-copy"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getDocumentUri</span>(wrapper<span class="op">:</span> MonacoEditorLanguageClientWrapper)<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper<span class="op">.</span><span class="fu">getModel</span>()<span class="op">!.</span><span class="at">uri</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">// At the end of `executeClassic`</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> wrapper<span class="op">.</span><span class="fu">getLanguageClient</span>()<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>client) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"Unable to obtain language client!"</span>)<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setup</span>(client<span class="op">,</span> <span class="fu">getDocumentUri</span>(wrapper))<span class="op">;</span> <span class="co">// setup function of the setup.ts file</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You will find an example of communication between the client and the server from the client’s perspective in the <code>setup.ts</code> file (lines 63 and 66).</p>
<p>On the server side, we need to modify the function <code>src/language/main-browser.ts</code> by adding this code at the end of the file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode ts code-with-copy"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getModelFromUri</span>(uri<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="op">&lt;</span>YourRootConceptFromVisitor<span class="op">&gt;</span> <span class="op">|</span> <span class="dt">undefined</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> <span class="bu">document</span> <span class="op">=</span> shared<span class="op">.</span><span class="at">workspace</span><span class="op">.</span><span class="at">LangiumDocuments</span><span class="op">.</span><span class="fu">getDocument</span>(URI<span class="op">.</span><span class="fu">parse</span>(uri))<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="bu">document</span> <span class="op">&amp;&amp;</span> <span class="bu">document</span><span class="op">.</span><span class="at">diagnostics</span> <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> <span class="bu">document</span><span class="op">?.</span><span class="at">diagnostics</span><span class="op">?.</span><span class="fu">filter</span>((i) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">severity</span> <span class="op">===</span> <span class="dv">1</span>)<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">document</span><span class="op">.</span><span class="at">parseResult</span><span class="op">.</span><span class="at">value</span> <span class="im">as</span> <span class="op">&lt;</span>YourRootConceptFromVisitor<span class="op">&gt;;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">undefined</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>connection<span class="op">.</span><span class="fu">onNotification</span>(<span class="st">"custom/hello"</span><span class="op">,</span> (uri<span class="op">:</span> <span class="dt">string</span>) <span class="kw">=&gt;</span> connection<span class="op">.</span><span class="fu">sendNotification</span>(<span class="st">"custom/hello"</span><span class="op">,</span> <span class="st">"World"</span>))<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here, we are listening a notification with the method <code>custom/hello</code>. When received, we are sending “World” to the client on the same method. The client will display <code>Hello World!</code> in the console. For your own code, you can replace the <code>"World"</code> by a call to your visitor. The method <code>getModelFromUri</code>, enables, from a document URI, to get your root concept or <code>undefined</code> if the program is not valid. Even if it is not used in this example, you can use it for your own code.</p>
<p>Finally, you can execute <code>npm run serve</code> to run your server/client architecture, and go to the printed URL to test your application.</p>
</section>
<section id="compilation" class="level3">
<h3 class="anchored" data-anchor-id="compilation">Compilation:</h3>
<p>Since the objective of this lab is to be able to program a small four-wheeled robot using your language, you will need to be able to compile your code to something the robot can understand - in this case, the robot uses an Arduino card, which can be programmed using a <a href="https://www.arduino.cc/reference/en/">subset of C</a>. You will need to write a compiler that generates Arduino code based on the defined model.</p>
<p>To test your compiler, you will need the <a href="https://www.arduino.cc/en/software">Arduino IDE</a>. At first, you will not need the robot and just verify that the generated code is valid (Verify action in Arduino IDE). When your generator generates valid Arduino programs, ask your teacher the robot to verify the correct (or not) behavior.</p>
<p>In the same idea as an interpreter, a compiler can also be implemented using a visitor pattern - but instead of directly simulating the behavior, you will generate the Arduino code representing this behavior.</p>
<p>As previously, you can put your visitor in the semantics folder. You can then use your compiler by adding a new command to the Command Line Interface provided by Langium, which will be the entry point from which you call the rest of your functions. Registering new commands can be done in <code>src/cli/main.ts</code>; once that is done, you should be able to call <code>./bin/cli.js compile &lt;source&gt;</code> (or <code>node ./bin/cli.js compile &lt;source&gt;</code>) in your terminal and have it generate Arduino code corresponding to the source program given as argument.</p>
<p>To understand how to call the semantics from the command line, we propose you to first create a ‘parseAndValidate’ action. The description of the ‘parseAndValidate’ action can be found <a href="https://langium.org/docs/learn/minilogo/customizing_cli/">here</a> (<a href="https://web.archive.org/web/20240916195444/https://langium.org/docs/learn/minilogo/customizing_cli/">archive</a>). After that, you will be able to call your visitor in a ‘generate’ action.</p>
<p>You will find in the <code>Compiler</code> folder an example of code to control the robot. The global structure of this program will not require many changes. If you want details on the possible actions, go look at the definition of the <code>demoAction</code> function used in the example, it uses most of the possible movements.</p>
<blockquote class="blockquote">
<p>You can find it in the MotorWheel lib, in the <code>Omni4WD.cpp</code> file</p>
</blockquote>
<blockquote class="blockquote">
<p>[!WARNING] This robot requires non-classical libraries, you will have to add them. Copy the folders in the <code>compiler/Arduino Example/lib/</code> folder in the <code>libraries</code> folder of your Arduino IDE.</p>
</blockquote>
</section>
</section>
<section id="known-issues" class="level2">
<h2 class="anchored" data-anchor-id="known-issues">Known issues</h2>
<section id="no-run-configuration-when-trying-to-generate-the-langium-grammar-from-the-xtext-one" class="level3">
<h3 class="anchored" data-anchor-id="no-run-configuration-when-trying-to-generate-the-langium-grammar-from-the-xtext-one">No run configuration when trying to generate the Langium grammar from the Xtext one</h3>
<p><strong>Have you installed the Eclipse plugin?</strong><br>
<strong>Have you added the plugin to your Xtext project?</strong><br>
<strong>Have you modified the <code>.mwe2</code> file?</strong></p>
<p>If yes to all the questions, so you have to uninstall the MWE2 SDK and reinstall it. For that:</p>
<ul>
<li>Go to Help → About Eclipse IDE</li>
<li>Click on “Installation Details”</li>
<li>Search for “MWE2 Language SDK” and uninstall it</li>
<li>Confirm the different steps until Eclipse is restarted</li>
<li>Go to Help → Install New Software…</li>
<li>On “Work with”, choose <code>2024-12 - https://download.eclipse.org/releases/2024-12</code></li>
<li>Search for MWE SDK and install it</li>
<li>Confirm the different steps until Eclipse is restarted Then, it should work.</li>
</ul>
</section>
<section id="some-grammar-rules-are-not-generated-in-my-xtext-grammar" class="level3">
<h3 class="anchored" data-anchor-id="some-grammar-rules-are-not-generated-in-my-xtext-grammar">Some grammar rules are not generated in my Xtext grammar</h3>
<p>At the creation of the Xtext project, when choosing your metamodel, be aware to correctly select your root concept in the drop-down list.</p>
</section>
<section id="the-comments-of-the-generated-langium-grammar-dont-work" class="level3">
<h3 class="anchored" data-anchor-id="the-comments-of-the-generated-langium-grammar-dont-work">The comments of the generated Langium grammar don’t work</h3>
<p>The Xtext to Langium plugin seems to badly generate the comment rules. To fix that, remove the ones generated by the plugin in your terminal Langium file (<code>SL_COMMENT</code> and <code>ML_COMMENT</code>) and replace them with the following:</p>
<pre><code>hidden terminal ML_COMMENT: /\/\*[\s\S]*?\*\//;
hidden terminal SL_COMMENT: /\/\/[^\n\r]*/;</code></pre>
</section>
<section id="in-langium-my-cross-references-dont-work-even-if-the-grammar-looks-correct" class="level3">
<h3 class="anchored" data-anchor-id="in-langium-my-cross-references-dont-work-even-if-the-grammar-looks-correct">In Langium, my cross-references don’t work even if the grammar looks correct</h3>
<p>This may be linked to how Langium resolves the cross-references (the linking step). By default, a named element (instance of a concept with an attribute <code>name</code>) is visible to all the elements that are (transitive) children of its container. If there’s an element in the middle of A and the elements you want A to be accessible, so merge the concept of A and its container.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/scope.png" class="img-fluid figure-img"></p>
<figcaption>scope</figcaption>
</figure>
</div>
</section>
<section id="the-langium-visitor-visitor-is-not-found" class="level3">
<h3 class="anchored" data-anchor-id="the-langium-visitor-visitor-is-not-found">The <code>langium-visitor</code> visitor is not found</h3>
<p>This error occurs only on Windows computers. To resolve the problem, install <code>langium-visitor</code> in global:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> i <span class="at">-g</span> langium-visitor</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>